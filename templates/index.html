<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Moody Music Player</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<style>
:root {
  --primary-color: #000307;
  --accent-color: #fff;
  --bg-dark: #121212;
  --bg-light: #f9f9f9;
  --text-dark: #fdf8f8;
  --text-light: #121212;
  --card-dark: #1e1e1e;
  --card-light: #fff;
}

body {
  margin: 0;
  font-family: 'Montserrat', sans-serif;
  background-color: var(--bg-dark);
  color: var(--text-dark);
  display: flex;
  min-height: 100vh;
  transition: all 0.3s ease;
}

body.light {
  background-color: var(--bg-light);
  color: var(--text-light);
}

.sidebar {
  width: 220px;
  background: linear-gradient(180deg, #8e2de2, #ff6a00); /* Purple â†’ Orange gradient */
  display: flex;
  flex-direction: column;
  padding: 20px;
  border-radius: 0 20px 20px 0;
  box-shadow: 2px 0 12px rgba(0,0,0,0.4);
}


.main { flex: 1; padding: 20px; display: flex; flex-direction: column; }
.controls { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; align-items: center; }
input, select, button { padding: 8px 12px; border-radius: 6px; border: none; cursor: pointer; }
select { background-color: #222; color: #fff; }
#searchSong { flex: 1; min-width: 150px; }
button#getSongsBtn { background-color: var(--primary-color); color: #fff; font-weight: 600; }
button#getSongsBtn:hover { background-color: #eda2d7; }

#quote { margin: 10px 0; font-style: italic; }
.song-list, .favorites-list, .playlist-list { display: grid; grid-template-columns: repeat(auto-fill,minmax(200px,1fr)); gap: 15px; }

.song-card { background-color: var(--card-dark); padding: 10px; border-radius: 10px; display: flex; flex-direction: column; justify-content: space-between; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
body.light .song-card { background-color: var(--card-light); }
.song-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }
.song-card img { border-radius: 8px; width: 100%; }
.song-card .info { margin: 10px 0 5px; font-weight: 600; font-size: 14px; }
.song-card .subinfo { font-size: 12px; color: #aaa; }
.song-card .actions { display: flex; justify-content: space-between; align-items: center; }
.heart { font-size: 20px; cursor: pointer; }
.heart.favorited { color: red; }

.theme-toggle { padding: 8px 12px; border-radius: 6px; border: none; background-color: var(--primary-color); color: #fff; cursor: pointer; }
.theme-toggle:hover { background-color: #eaf5ee; }

@media(max-width: 800px){
  body{ flex-direction: column; }
  .sidebar { width: 100%; flex-direction: row; overflow-x: auto; }
  .main { padding: 10px; }
}
</style>
</head>
<body>

<div class="sidebar">
  <h2>Moody Music</h2>
  <button onclick="scrollToSection('songList')">Songs</button>
  <button onclick="scrollToSection('favorites')">Favorites</button>
  <button class="theme-toggle">Toggle Theme</button>
</div>

<div class="main">
  <div class="controls">
    <input type="text" id="searchSong" placeholder="Search songs...">
    <select id="mood">
      <option value="happy">Happy</option>
      <option value="sad">Sad</option>
      <option value="relaxed">Relaxed</option>
      <option value="energetic">Energetic</option>
    </select>
    <select id="language">
      <option value="hindi">Hindi</option>
      <option value="english">English</option>
      <option value="marathi">Marathi</option>
    </select>
    <button id="getSongsBtn">Get Songs</button>
  </div>
  <div id="quote"></div>
  <div id="player-container"></div>

  <h2>Songs</h2>
  <div class="song-list" id="songList"></div>

  <h2>Favorites</h2>
  <div class="favorites-list" id="favorites"></div>

  <h2>Playlist</h2>
  <div class="playlist-list" id="playlist"></div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
let player;
const favoriteSet = new Set();
let playlist = [];

// Theme toggle
document.querySelector(".theme-toggle").onclick = () => document.body.classList.toggle("light");

// Scroll helper
function scrollToSection(id){ document.getElementById(id).scrollIntoView({behavior:"smooth"}); }

// Play song
function playSong(videoId, title, artist, thumb){
  const container = document.getElementById("player-container");
  container.innerHTML = `
    <div class="player-card">
      <img src="${thumb}" alt="${title}">
      <div class="info"><div>${title}</div><div class="subinfo">${artist}</div></div>
      <div class="controls"><button id="playPauseBtn">Play</button><input type="range" id="volumeSlider" min="0" max="100" value="50"></div>
    </div>
    <div id="iframe-player"></div>
  `;

  player = new YT.Player('iframe-player', {
    height:'360', width:'640', videoId: videoId,
    events: {'onReady': e=>player.setVolume(50), 'onStateChange': onPlayerStateChange}
  });

  const playPauseBtn = document.getElementById("playPauseBtn");
  const volumeSlider = document.getElementById("volumeSlider");
  playPauseBtn.onclick = () => {
    if(player.getPlayerState() === YT.PlayerState.PLAYING){ player.pauseVideo(); playPauseBtn.innerText="Play"; }
    else { player.playVideo(); playPauseBtn.innerText="Pause"; }
  };
  volumeSlider.oninput = ()=>player.setVolume(volumeSlider.value);
}

// Auto-play next in playlist
let currentPlaylistIndex = 0;
function playNextInPlaylist(){
  if(playlist.length === 0) return;
  currentPlaylistIndex = (currentPlaylistIndex + 1) % playlist.length;
  const nextSong = playlist[currentPlaylistIndex];
  playSong(nextSong.videoId, nextSong.title, nextSong.artist, nextSong.thumb);
}

// YT Player state change
function onPlayerStateChange(event){
  const btn = document.getElementById("playPauseBtn");
  if(event.data === YT.PlayerState.PLAYING) btn.innerText="Pause";
  else if(event.data === YT.PlayerState.ENDED) playNextInPlaylist();
  else btn.innerText="Play";
}

// Favorites
function toggleFavorite(card, videoId){
  const heart = card.querySelector(".heart");
  if(favoriteSet.has(videoId)){ favoriteSet.delete(videoId); heart.classList.remove("favorited"); }
  else { favoriteSet.add(videoId); heart.classList.add("favorited"); }
  renderFavorites();
}

function renderFavorites(){
  const favContainer = document.getElementById("favorites");
  favContainer.innerHTML = "";
  favoriteSet.forEach(id=>{
    const orig = document.querySelector(`[data-id='${id}']`);
    if(!orig) return;
    const card = orig.cloneNode(true);
    card.querySelector(".play-btn").onclick = ()=>playSong(card.dataset.id, card.dataset.title, card.dataset.artist, card.dataset.thumb);
    card.querySelector(".heart").onclick = ()=>toggleFavorite(card, card.dataset.id);
    favContainer.appendChild(card);
  });
}

// Playlist functions
function addToPlaylist(card){
  const songId = card.dataset.id;
  if(!playlist.some(s=>s.videoId===songId)){
    playlist.push({
      videoId: songId,
      title: card.dataset.title,
      artist: card.dataset.artist,
      thumb: card.dataset.thumb
    });
    renderPlaylist();
  }
}

function removeFromPlaylist(videoId){
  playlist = playlist.filter(s=>s.videoId!==videoId);
  renderPlaylist();
}

function renderPlaylist(){
  const pl = document.getElementById("playlist");
  pl.innerHTML = "";
  playlist.forEach(song=>{
    const card = document.createElement("div");
    card.className = "song-card";
    card.dataset.id = song.videoId;
    card.dataset.title = song.title;
    card.dataset.artist = song.artist;
    card.dataset.thumb = song.thumb;
    card.innerHTML = `
      <img src="${song.thumb}" alt="${song.title}">
      <div class="info">${song.title}</div>
      <div class="subinfo">${song.artist}</div>
      <div class="actions">
        <button class="play-btn">Play</button>
        <button class="remove-playlist">Remove</button>
      </div>
    `;
    card.querySelector(".play-btn").onclick = ()=>playSong(song.videoId, song.title, song.artist, song.thumb);
    card.querySelector(".remove-playlist").onclick = ()=>removeFromPlaylist(song.videoId);
    pl.appendChild(card);
  });
}

// Search feature
document.getElementById("searchSong").oninput = function(){
  const filter = this.value.toLowerCase();
  document.querySelectorAll("#songList .song-card").forEach(song=>{
    const title = song.dataset.title.toLowerCase();
    const artist = song.dataset.artist.toLowerCase();
    song.style.display = (title.includes(filter) || artist.includes(filter)) ? "flex" : "none";
  });
}

// Fetch songs
document.getElementById("getSongsBtn").onclick = async ()=>{
  const mood = document.getElementById("mood").value;
  const language = document.getElementById("language").value;
  const response = await fetch("/get-songs", {
    method:"POST", headers:{"Content-Type":"application/json"},
    body: JSON.stringify({mood, language})
  });
  const data = await response.json();
  const songListDiv = document.getElementById("songList");
  songListDiv.innerHTML = "";

  const quotes = {
    happy: "Keep smiling, life is beautiful! ðŸ˜Š",
    sad: "Better days are coming....Never Give Up!!ðŸŒˆ",
    relaxed: "Peace begins with a breath ðŸŒ¿",
    energetic: "You are unstoppable! âš¡"
  };
  document.getElementById("quote").innerText = quotes[mood] || "";

  if(data.songs && data.songs.length>0){
    data.songs.forEach(song=>{
      const card = document.createElement("div");
      card.className = "song-card";
      card.dataset.id = song.video_id;
      card.dataset.title = song.name;
      card.dataset.artist = song.artist;
      card.dataset.thumb = `https://img.youtube.com/vi/${song.video_id}/hqdefault.jpg`;
      card.innerHTML = `
        <img src="${card.dataset.thumb}" alt="${song.name}">
        <div class="info">${song.name}</div>
        <div class="subinfo">${song.artist}</div>
        <div class="actions">
          <button class="play-btn">Play</button>
          <span class="heart">&#10084;</span>
          <button class="add-playlist">âž• Playlist</button>
        </div>
      `;
      card.querySelector(".play-btn").onclick = ()=>playSong(song.video_id, song.name, song.artist, card.dataset.thumb);
      card.querySelector(".heart").onclick = ()=>toggleFavorite(card, song.video_id);
      card.querySelector(".add-playlist").onclick = ()=>addToPlaylist(card);
      songListDiv.appendChild(card);
    });
  } else songListDiv.innerHTML="<p>No songs found.</p>";
}
</script>
</body>
</html>
